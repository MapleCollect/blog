---
title: jni 通过c/c++返回HashMap等复杂参数给java
categories:
- 文章
tags: 
- jni
date: 2015-07-02 16:15:11
---

  返回其他对象与这个相似，可以自己研究下

思路：

    1.创建HashMap对象：
<pre class="brush:cpp;toolbar:false">    /*C语言版本，下同*/
    //获取java的HashMap类
   jclass class_hashmap = (*env)-&gt;FindClass(env, &quot;java/util/HashMap&quot;);
   
   //获取类似于java 的new HashMap();
    jmethodID hashmap_init = (*env)-&gt;GetMethodID(env, class_hashmap, &quot;&lt;init&gt;&quot;,
            &quot;()V&quot;);
    //初始化。类似于hashMap=new HashMap();
    jobject HashMap = (*env)-&gt;NewObject(env, class_hashmap, hashmap_init, &quot;&quot;);
    //获取hashMap.put()的ID
    jmethodID HashMap_put = (*env)-&gt;GetMethodID(env, class_hashmap, &quot;put&quot;,
            &quot;(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&quot;);</pre>

   2\. 赋值：
<pre class="brush:cpp;toolbar:false;">    //类似于map.put(&quot;key&quot;,&quot;value&quot;);
    //(*env)-&gt;NewStringUTF(env, &quot;key值&quot;)不能直接用&quot;key值&quot;替代
  (*env)-&gt;CallObjectMethod(env, HashMap, HashMap_put, (*env)-&gt;NewStringUTF(env, &quot;key值&quot;), (*env)-&gt;NewStringUTF(env, &quot;value值&quot;));</pre>
<!-- more -->
全部代码：

    JniClient.java
<pre class="brush:java;toolbar:false">package com.ndk.test;
import java.util.HashMap;
public class JniClient {
    public static native HashMap&lt;String, String&gt; setMap();
}</pre>

JniClient.h
<pre class="brush:cpp;toolbar:false">/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class com_ndk_test_JniClient */
#ifndef _Included_com_ndk_test_JniClient
#define _Included_com_ndk_test_JniClient
#ifdef __cplusplus
extern &quot;C&quot; {
#endif
/*
 * Class:     com_ndk_test_JniClient
 * Method:    setMap
 * Signature: ()Ljava/util/HashMap;
 */
JNIEXPORT jobject JNICALL Java_com_ndk_test_JniClient_setMap
  (JNIEnv *, jclass);
#ifdef __cplusplus
}
#endif
#endif</pre>

JniClient.c
<pre class="brush:cpp;toolbar:false">#include &quot;com_ndk_test_JniClient.h&quot;
#include&lt;stdio.h&gt;
#ifdef __cplusplus
extern &quot;C&quot;
{
#endif
JNIEXPORT jobject JNICALL Java_com_ndk_test_JniClient_setMap(JNIEnv *env,
        jclass cls) {
    jclass class_hashmap = (*env)-&gt;FindClass(env, &quot;java/util/HashMap&quot;);
    jmethodID hashmap_init = (*env)-&gt;GetMethodID(env, class_hashmap, &quot;&lt;init&gt;&quot;,
            &quot;()V&quot;);
    jobject HashMap = (*env)-&gt;NewObject(env, class_hashmap, hashmap_init, &quot;&quot;);
    jmethodID HashMap_put = (*env)-&gt;GetMethodID(env, class_hashmap, &quot;put&quot;,
            &quot;(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;&quot;);
    (*env)-&gt;CallObjectMethod(env, HashMap, HashMap_put, (*env)-&gt;NewStringUTF(env, &quot;key1&quot;), (*env)-&gt;NewStringUTF(env, &quot;value1&quot;));
    (*env)-&gt;CallObjectMethod(env, HashMap, HashMap_put,(*env)-&gt;NewStringUTF(env, &quot;key2&quot;), (*env)-&gt;NewStringUTF(env, &quot;value2&quot;));
    return HashMap;
}
#ifdef __cplusplus
}
#endif</pre>

引用方法：

<pre class="brush:java;toolbar:false">Object object=JniClient.setMap();
HashMap&lt;String, String&gt;map=(HashMap&lt;String, String&gt;)object;
System.out.println(&quot;size:&quot;+map.size()+&quot;;value:&quot;+map.get(&quot;key1&quot;));</pre>

打印信息：

size:2;value:value1