---
title: 获取百度网盘真实下载链接
categories:
- 杂七杂八
tags: 
- 百度云
- 真实链接
date: 2015-07-15 10:15:12
---

<span style="color: rgb(255, 0, 0);">本代码为原创，转载请注明</span>

目前还存在一个问题，同一ip在获取3次以后会出现验证码，会获取失败，大家可以讨论研究下
<!-- more -->
主要代码：

HttpRequest.java
<pre class="brush:java;toolbar:false">import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.RandomAccessFile;
import java.lang.reflect.Method;
import java.net.HttpURLConnection;
import java.net.URL;
public class HttpRequest {
    public static String getData(String u) throws Exception {
        String re=&quot;&quot;;
                URL url = new URL(u);
        HttpURLConnection httpURLConnection = (HttpURLConnection) url
                .openConnection();
        httpURLConnection.setRequestMethod(&quot;GET&quot;);
        httpURLConnection.setDoInput(true);
        httpURLConnection.setDoOutput(true);
        InputStream is = httpURLConnection.getInputStream();
        InputStreamReader isr = new InputStreamReader(is);
        BufferedReader bufferedReader = new BufferedReader(isr);
        String iL = &quot;&quot;;
        while ((iL = bufferedReader.readLine()) != null) {
            re += iL + &quot;\n&quot;;
        }
        
        return re;
    }
}</pre>

获取方法：
<pre class="brush:java;toolbar:false">import java.net.URLEncoder;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import org.json.JSONArray;
import org.json.JSONObject;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
public class BaiduNetDisk {
    public static List&lt;Map&lt;String, Object&gt;&gt; getUrl(String url) throws Exception {
        List&lt;String&gt; fs_id = new ArrayList&lt;String&gt;();
        List&lt;Map&lt;String, Object&gt;&gt; list = new ArrayList&lt;Map&lt;String, Object&gt;&gt;();
        Document doc = Jsoup.connect(url).get();
        String html = doc.toString();
        int a = html.indexOf(&quot;{\&quot;typicalPath&quot;);
        int b = html.indexOf(&quot;yunData.getCon&quot;);
        int sign_head = html.indexOf(&quot;yunData.SIGN = \&quot;&quot;);
        int sign_foot = html.indexOf(&quot;yunData.TIMESTAMP&quot;);
        int time_head = html.indexOf(&quot;yunData.TIMESTAMP = \&quot;&quot;);
        int time_foot = html.indexOf(&quot;yunData.SHARE_UK&quot;);
        int share_id_head = html.indexOf(&quot;yunData.SHARE_ID = \&quot;&quot;);
        int share_id_foot = html.indexOf(&quot;yunData.SIGN &quot;);
        String sign = html.substring(sign_head, sign_foot);
        sign = sign.substring(sign.indexOf(&quot;\&quot;&quot;) + 1, sign.indexOf(&quot;\&quot;;&quot;));
        String time = html.substring(time_head, time_foot);
        time = time.substring(time.indexOf(&quot;\&quot;&quot;) + 1, time.indexOf(&quot;\&quot;;&quot;));
        String share_id = html.substring(share_id_head, share_id_foot);
        share_id = share_id.substring(share_id.indexOf(&quot;\&quot;&quot;) + 1,
                share_id.indexOf(&quot;\&quot;;&quot;));
        System.out.println(share_id);
        html = html.substring(a, b);
        a = html.indexOf(&quot;{\&quot;typicalPath&quot;);
        b = html.indexOf(&quot;};&quot;);
        JSONArray jsonArray = new JSONArray(&quot;[&quot; + html.substring(a, b + 1)
                + &quot;]&quot;);
        JSONObject jsonObject = jsonArray.getJSONObject(0);
        String uk = jsonObject.getString(&quot;uk&quot;);
        String shareid = jsonObject.getString(&quot;shareid&quot;);
        String path = URLEncoder.encode(jsonObject.getString(&quot;typicalPath&quot;),
                &quot;utf-8&quot;);
        jsonArray = new JSONArray(&quot;[&quot; + jsonObject.getString(&quot;file_list&quot;) + &quot;]&quot;);
        jsonObject = jsonArray.getJSONObject(0);
        jsonArray = new JSONArray(jsonObject.getString(&quot;list&quot;));
        jsonObject = jsonArray.getJSONObject(0);
        String app_id = jsonObject.getString(&quot;app_id&quot;);
        if (jsonObject.getString(&quot;isdir&quot;).equals(&quot;1&quot;)) {
            String url1 = &quot;http://pan.baidu.com/share/list?uk=&quot;
                    + uk
                    + &quot;&amp;shareid=&quot;
                    + shareid
                    + &quot;&amp;page=1&amp;num=100&amp;dir=&quot;
                    + path
                    + &quot;&amp;order=time&amp;desc=1&amp;_=&quot;
                    + time
                    + &quot;&amp;bdstoken=c51077ce0e0e313a16066612a13fbcd4&amp;channel=chunlei&amp;clienttype=0&amp;web=1&amp;app_id=&quot;
                    + app_id;
            String fileListJson = HttpRequest.getData(url1);
            System.out.println(fileListJson);
            jsonArray = new JSONArray(&quot;[&quot; + fileListJson + &quot;]&quot;);
            jsonObject = jsonArray.getJSONObject(0);
            jsonArray = new JSONArray(jsonObject.getString(&quot;list&quot;));
        }
        final int size = jsonArray.length();
        for (int i = 0; i &lt; size; i++) {
            Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;();
            jsonObject = jsonArray.getJSONObject(i);
            String fileName = jsonObject.getString(&quot;server_filename&quot;);
            map.put(&quot;fileName&quot;, fileName);
            fs_id.add(jsonObject.getString(&quot;fs_id&quot;));
            String fileInfo = HttpRequest
                    .getData(&quot;http://pan.baidu.com/api/sharedownload?sign=&quot;
                            + sign
                            + &quot;&amp;timestamp=&quot;
                            + time
                            + &quot;&amp;bdstoken=c51077ce0e0e313a16066612a13fbcd4&amp;channel=chunlei&amp;clienttype=0&amp;web=1&amp;app_id=250528&amp;encrypt=0&amp;product=share&amp;uk=&quot;
                            + uk + &quot;&amp;primaryid=&quot; + share_id + &quot;&amp;fid_list=%5B&quot;
                            + fs_id.get(i) + &quot;%5D&quot;);
            JSONArray jsonArray2 = new JSONArray(&quot;[&quot; + fileInfo + &quot;]&quot;);
            JSONObject json_data = jsonArray2.getJSONObject(0);
            if (json_data.getString(&quot;errno&quot;).equals(&quot;0&quot;)) {
                jsonArray2 = new JSONArray(json_data.getString(&quot;list&quot;));
                json_data = jsonArray2.getJSONObject(0);
                map.put(&quot;url&quot;, json_data.getString(&quot;dlink&quot;));
            } else if (json_data.getString(&quot;errno&quot;).equals(&quot;-20&quot;)) {
                return null;
                // String getVerCode();
            } else {
                return null;
            }
            list.add(map);
        }
        return list;
    }
}</pre>